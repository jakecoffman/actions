name: Does Artifact use Quota

on:
  workflow_dispatch:

env:
  GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
  does:
    name: Does Artifact use Quota
    runs-on: ubuntu-latest
    steps:
      - name: Output current API quota (initial)
        run: |
          gh api "https://api.github.com/rate_limit" | jq .

      - name: Create test file for upload
        run: |
          echo "This is a test file for artifact upload" > test-artifact.txt
          cat test-artifact.txt

      - name: Output current API quota (before upload)
        run: |
          gh api "https://api.github.com/rate_limit" | jq .

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: test-artifact
          path: test-artifact.txt

      - name: Output current API quota (after upload)
        run: |
          gh api "https://api.github.com/rate_limit" | jq .

      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: test-artifact
          path: downloaded

      - name: Output current API quota (after download)
        run: |
          gh api "https://api.github.com/rate_limit" | jq .

      - name: Verify downloaded artifact
        run: |
          cat downloaded/test-artifact.txt
